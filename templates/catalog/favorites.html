{% extends 'base.html' %}
{% load static formatting %}

{% block title %}Избранное{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Избранное</h3>
  <a class="btn btn-outline-secondary" href="{% url 'car_list' %}">← Назад к каталогу</a>
</div>

{% if cars %}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
    {% for car in cars %}
      <div class="col">
        <div class="card h-100">
          {% if car.image %}
            <img src="{{ car.image.url }}" class="card-img-top" alt="{{ car }}">
          {% else %}
            <img src="{% static 'img/placeholder_car.jpg' %}" class="card-img-top" alt="Нет фото">
          {% endif %}

          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ car.brand }} {{ car.model.name }}</h6>
            <div class="text-secondary small mb-2">
              {{ car.year }} · {{ car.get_engine_type_display }} · {{ car.get_transmission_display }}
            </div>
            <div class="fw-bold mb-3">{{ car.price|spaced_money }} ₽</div>

            <div class="mt-auto d-flex gap-2">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'car_detail' car.pk %}">
                <i class="bi bi-search"></i>
              </a>

              {# Снять/добавить в избранное #}
              <form method="post" action="{% url 'favorite_toggle' car.pk %}">
                {% csrf_token %}
                <button class="btn btn-sm {% if car.id in fav_ids %}btn-warning{% else %}btn-outline-warning{% endif %}">
                  {% if car.id in fav_ids %}<i class="bi bi-star-fill"></i>{% else %}<i class="bi bi-star"></i>{% endif %}
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">Избранных автомобилей пока нет.</div>
{% endif %}
{% endblock %}
